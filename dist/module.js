!function(){var util,net,logger,objAdd,insp,obtain,parseTmp,parseDate,hasContent,includes,isSolidString,isPlainObject,smbcn,MODULE_TITLE;Wsh&&Wsh.SmbConnector||(Wsh.SmbConnector={},util=Wsh.Util,Wsh.FileSystem,net=Wsh.Net,logger=Wsh.Logger,objAdd=Object.assign,insp=util.inspect,obtain=util.obtainPropVal,parseTmp=util.parseTemplateLiteral,parseDate=util.parseDateLiteral,hasContent=util.hasContent,includes=util.includes,isSolidString=util.isSolidString,isPlainObject=util.isPlainObject,smbcn=Wsh.SmbConnector,MODULE_TITLE="WshSmbConnector/SmbConnector.js",smbcn.connectSyncSurelyUsingLog=function(comp,shareName,domain,user,pwd,options){var FN="smbcn.connectSyncSurelyUsingLog",loggerObj=obtain(options,"logger",{}),lggr=logger.create(loggerObj);lggr.info("Start the function "+FN),lggr.info('Connecting to "'+comp+'"'),lggr.info('shareName: "'+shareName+'"'),lggr.info('domain: "'+domain+'", user: "'+user+'"'),lggr.info('password: "****"');var throws=obtain(options,"throws",!1);lggr.info("throws: "+String(throws));var retVal,isDryRun=obtain(options,"isDryRun",!1);try{retVal=net.SMB.connectSyncSurely(comp,shareName,domain,user,pwd,{isDryRun:isDryRun}),isDryRun&&lggr.info("dry-run ["+FN+"]: "+retVal),lggr.success("Succeeded the connecting!")}catch(e){if(throws)throw new Error(insp(e));lggr.error(insp(e))}lggr.info("Finished the function "+FN),obtain(options,"transportsLog",!0)&&lggr.transport(),obtain(options,"showsResult",!1)&&net.SMB.showCurrentSession()},smbcn.connectSyncUsingSchema=function(schema,query,options){var functionName,typeErrVal,FN="smbcn.connectSyncUsingSchema";isPlainObject(schema)||(functionName=FN,typeErrVal=schema,util.throwTypeError("object",MODULE_TITLE,functionName,typeErrVal)),isSolidString(query)||function(functionName,typeErrVal){util.throwTypeError("string",MODULE_TITLE,functionName,typeErrVal)}(FN,query);var loggerObj=obtain(options,"logger",{}),lggr=logger.create(loggerObj);lggr.info("Start function "+FN),lggr.info('query: "'+query+'"');var rsrcNames=Object.keys(schema.tasks),regNameMatcher=includes(query,"*")?new RegExp(query.replace(/\*/g,".*")):new RegExp(query),filteredNames=rsrcNames.filter(function(rsrcName){return regNameMatcher.test(rsrcName)});lggr.info("matched tasks: "+filteredNames.length);var vals=schema.components;hasContent(options.overwrites)&&Object.keys(vals).forEach(function(key){null===vals[key]&&Object.keys(options.overwrites).some(function(writeKey){if(key===writeKey)return vals[key]=options.overwrites[writeKey],!0})});var rsrcs=schema.tasks;obtain(options,"isDryRun",!1)&&lggr.info("dry-run ["+FN+"]:"),filteredNames.forEach(function(rsrcName){if(!1!==rsrcs[rsrcName].available){var comp=parseDate(parseTmp(rsrcs[rsrcName].comp||"",vals)),share=parseDate(parseTmp(rsrcs[rsrcName].share||"",vals)),domain=parseDate(parseTmp(rsrcs[rsrcName].domain||"",vals)),user=parseDate(parseTmp(rsrcs[rsrcName].user||"",vals)),pwd=parseDate(parseTmp(rsrcs[rsrcName].pwd||"",vals));try{smbcn.connectSyncSurelyUsingLog(comp,share,domain,user,pwd,objAdd({},options,{logger:lggr,transportsLog:!1,showsResult:!1,"throws":!1}))}catch(e){lggr.error(insp(e))}}else lggr.info("Skip the non-available task: "+rsrcName)}),lggr.info("Finished function "+FN),obtain(options,"transportsLog",!0)&&lggr.transport(),obtain(options,"showsResult",!1)&&net.SMB.showCurrentSession()})}();
