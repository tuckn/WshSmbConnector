!function(){var util,net,logger,objAdd,insp,obtain,parseTmp,parseDate,hasContent,includes,isSolidString,isPlainObject,smbcn,MODULE_TITLE;Wsh&&Wsh.SmbConnector||(Wsh.SmbConnector={},util=Wsh.Util,Wsh.FileSystem,net=Wsh.Net,logger=Wsh.Logger,objAdd=Object.assign,insp=util.inspect,obtain=util.obtainPropVal,parseTmp=util.parseTemplateLiteral,parseDate=util.parseDateLiteral,hasContent=util.hasContent,includes=util.includes,isSolidString=util.isSolidString,isPlainObject=util.isPlainObject,smbcn=Wsh.SmbConnector,MODULE_TITLE="WshSmbConnector/SmbConnector.js",smbcn.connectSyncSurelyUsingLog=function(comp,shareName,domain,user,pwd,options){var retVal,FN="smbcn.connectSyncSurelyUsingLog",loggerObj=obtain(options,"logger",{}),loggerObj=logger.create(loggerObj),throws=(loggerObj.info("Start the function "+FN),loggerObj.info('Connecting to "'+comp+'"'),loggerObj.info('shareName: "'+shareName+'"'),loggerObj.info('domain: "'+domain+'", user: "'+user+'"'),loggerObj.info('password: "****"'),obtain(options,"throws",!1)),isDryRun=(loggerObj.info("throws: "+String(throws)),obtain(options,"isDryRun",!1));try{retVal=net.SMB.connectSyncSurely(comp,shareName,domain,user,pwd,{isDryRun:isDryRun}),isDryRun&&loggerObj.info("dry-run ["+FN+"]: "+retVal),loggerObj.success("Succeeded the connecting!")}catch(e){if(throws)throw new Error(insp(e));loggerObj.error(insp(e))}loggerObj.info("Finished the function "+FN),obtain(options,"transportsLog",!0)&&loggerObj.transport(),obtain(options,"showsResult",!1)&&net.SMB.showCurrentSession()},smbcn.connectSyncUsingSchema=function(schema,taskName,options){var FN="smbcn.connectSyncUsingSchema",loggerObj=(isPlainObject(schema)||util.throwTypeError("object",MODULE_TITLE,FN,schema),isSolidString(taskName)||!function(functionName,typeErrVal){util.throwTypeError("string",MODULE_TITLE,functionName,typeErrVal)}(FN,taskName),obtain(options,"logger",{})),lggr=logger.create(loggerObj),tasks=(lggr.info("Start function "+FN),lggr.info('taskName: "'+taskName+'"'),schema.tasks),loggerObj=Object.keys(tasks),regNameMatcher=includes(taskName,"*")?new RegExp(taskName.replace(/\*/g,".*")):new RegExp(taskName),taskName=loggerObj.filter(function(taskName){return regNameMatcher.test(taskName)}),vals=(lggr.info("matched tasks: "+taskName.length),schema.components);hasContent(options.overwrites)&&Object.keys(vals).forEach(function(key){null===vals[key]&&Object.keys(options.overwrites).some(function(writeKey){if(key===writeKey)return vals[key]=options.overwrites[writeKey],!0})}),obtain(options,"isDryRun",!1)&&lggr.info("dry-run ["+FN+"]:"),taskName.forEach(function(taskName){if(lggr.info("Start the task: "+taskName),!1===tasks[taskName].available)lggr.info("available: false => Skip this task");else{var comp=parseDate(parseTmp(tasks[taskName].comp||"",vals)),share=parseDate(parseTmp(tasks[taskName].share||"",vals)),domain=parseDate(parseTmp(tasks[taskName].domain||"",vals)),user=parseDate(parseTmp(tasks[taskName].user||"",vals)),taskName=parseDate(parseTmp(tasks[taskName].pwd||"",vals));try{smbcn.connectSyncSurelyUsingLog(comp,share,domain,user,taskName,objAdd({},options,{logger:lggr,transportsLog:!1,showsResult:!1,"throws":!1}))}catch(e){lggr.error(insp(e))}}}),lggr.info("Finished function "+FN),obtain(options,"transportsLog",!0)&&lggr.transport(),obtain(options,"showsResult",!1)&&net.SMB.showCurrentSession()})}();
